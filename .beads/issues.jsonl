{"id":"PRISM-1ai","title":"PERF: Redis connection lacks connection pooling for pub/sub","description":"In server/services/redis-queue.ts:703, a separate Redis client is created for pub/sub but there's no connection pooling. Under high load, this could exhaust file descriptors. Consider using a shared connection pool.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T13:04:43.172963-06:00","updated_at":"2025-12-27T13:04:43.172963-06:00","labels":["performance","redis"]}
{"id":"PRISM-3d2","title":"PERF: Unbounded regex patterns in mention extraction","description":"In server/services/event-processor.ts:1284, the mention regex /@([a-zA-Z0-9.-]+)/g is applied to arbitrary post text without length limits. Malicious posts with extremely long text could cause regex performance issues. Add text length validation.","status":"open","priority":3,"issue_type":"bug","created_at":"2025-12-27T13:05:56.8583022-06:00","updated_at":"2025-12-27T13:05:56.8583022-06:00","labels":["performance","security"]}
{"id":"PRISM-51s","title":"FEAT: Missing request ID tracking for distributed tracing","description":"No request ID generation or propagation for distributed tracing. Add request ID middleware that generates unique IDs and propagates them through logs, Redis queue, and database operations for debugging.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-27T13:04:34.2770515-06:00","updated_at":"2025-12-27T13:04:34.2770515-06:00","labels":["feature","observability"]}
{"id":"PRISM-5fw","title":"PERF: Event processor pendingOp variable undefined","description":"In server/services/event-processor.ts:459, enqueuePendingUserCreationOp uses 'pendingOp' variable but it's never defined. Should be constructing a PendingUserCreationOp object. This causes the pending user creation queue to fail.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-27T13:03:57.1522912-06:00","updated_at":"2025-12-27T13:03:57.1522912-06:00","labels":["bug","event-processor"]}
{"id":"PRISM-6zt","title":"CODE: Missing validation for JSON body size in custom parser","description":"In server/index.ts:49, the 10MB body limit is checked but chunks continue to be collected after the limit is hit until destroy() completes. Add early termination when limit is exceeded to prevent memory exhaustion.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-27T13:06:41.9427614-06:00","updated_at":"2025-12-27T13:06:41.9427614-06:00","labels":["security","validation"]}
{"id":"PRISM-7zu","title":"SEC-LOW: CORS allows any origin with credentials","description":"In server/index.ts:113-115, CORS reflects any origin with credentials enabled. While documented as ATProto standard behavior, this could allow credential leakage from malicious sites. Consider restricting to known trusted origins for credential-bearing requests.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-27T13:05:19.293987-06:00","updated_at":"2025-12-27T13:05:19.293987-06:00","labels":["cors","security"]}
{"id":"PRISM-899","title":"CODE: Missing input validation for XRPC proxy requests","description":"The xrpc-proxy middleware should validate request parameters before proxying to external services. Missing validation could allow injection attacks or malformed requests to reach upstream services.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-27T13:04:52.2832477-06:00","updated_at":"2025-12-27T13:04:52.2832477-06:00","labels":["security","validation"]}
{"id":"PRISM-8yy","title":"FEAT: Missing admin rate limiting bypass","description":"Authenticated admins are subject to the same rate limits as regular users. Consider adding rate limit bypass or higher limits for authenticated admin requests to allow emergency operations.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-27T13:06:14.181214-06:00","updated_at":"2025-12-27T13:06:14.181214-06:00","labels":["admin","feature"]}
{"id":"PRISM-acc","title":"SEC-MED: WebSocket dashboard has no authentication","description":"The WebSocket dashboard endpoint at /ws in server/routes.ts has no authentication. Anyone can connect and receive real-time metrics, firehose status, and system health data. Should require authentication for non-public data.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T13:03:13.6270592-06:00","updated_at":"2025-12-27T13:31:03.7052222-06:00","closed_at":"2025-12-27T13:31:03.7052222-06:00","labels":["security","websocket"]}
{"id":"PRISM-bf8","title":"CODE: Error handling swallows exceptions in event processor","description":"In server/services/event-processor.ts, many catch blocks log errors but don't propagate them properly. Some catch blocks at lines 588, 1016-1025, 2618-2626 silently swallow errors without metrics or proper retry logic.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-27T13:05:37.699331-06:00","updated_at":"2025-12-27T13:05:37.699331-06:00","labels":["bug","error-handling"]}
{"id":"PRISM-cyq","title":"CODE: Sensitive data may leak in error responses","description":"In server/index.ts:214, error responses include err.message directly. Stack traces logged at line 203. Ensure production error responses don't leak sensitive internal details. Consider error sanitization middleware.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-27T13:06:23.6071004-06:00","updated_at":"2025-12-27T13:06:23.6071004-06:00","labels":["error-handling","security"]}
{"id":"PRISM-d30","title":"CODE: Missing audit logging for admin actions","description":"No audit trail for admin actions. When admins apply labels, backfill data, or perform moderation actions, there's no comprehensive logging of who did what and when. Add audit logging table and service for all admin operations.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-27T13:04:06.4635636-06:00","updated_at":"2025-12-27T13:04:06.4635636-06:00","labels":["audit","security"]}
{"id":"PRISM-dbv","title":"PERF: Database connection pool exhaustion under concurrent user creation","description":"The user creation semaphore (MAX_CONCURRENT_USER_CREATIONS=10) may not be sufficient during bulk operations. If PDS data fetching is slow, the semaphore blocks but connections are still held. Consider adding connection timeout handling.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-27T13:05:10.0856124-06:00","updated_at":"2025-12-27T13:05:10.0856124-06:00","labels":["database","performance"]}
{"id":"PRISM-e3z","title":"CODE: Database pool instances not properly tracked","description":"In server/db.ts, poolInstances Map is referenced but never properly imported or defined in the visible code. Pool registration may not be working correctly, affecting pool metrics and monitoring.","status":"open","priority":3,"issue_type":"bug","created_at":"2025-12-27T13:06:05.355202-06:00","updated_at":"2025-12-27T13:06:05.355202-06:00","labels":["bug","database"]}
{"id":"PRISM-fc8","title":"CODE: requireAdmin allows session without sessionId for AT Protocol tokens","description":"In server/services/auth.ts:512, requireAdmin calls validateAndRefreshSession with payload.sessionId. For AT Protocol tokens, sessionId is undefined. This could cause session validation to fail unexpectedly for valid admin tokens.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-27T13:04:16.3231086-06:00","updated_at":"2025-12-27T13:04:16.3231086-06:00","labels":["authentication","bug"]}
{"id":"PRISM-fok","title":"SEC-LOW: Auth token logging in production","description":"In server/services/auth.ts:414-415, Bearer tokens are logged with first 20 characters visible. In production, even partial tokens could be useful for attacks. Use structured logging with token ID only, not token content.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-27T13:03:39.200232-06:00","updated_at":"2025-12-27T13:35:09.0121125-06:00","closed_at":"2025-12-27T13:35:09.0121125-06:00","labels":["logging","security"]}
{"id":"PRISM-g4e","title":"FEAT: Missing database backup and restore procedures","description":"No documented or automated database backup procedures. For production deployment, add pg_dump automation, point-in-time recovery configuration, and documented restore procedures.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-27T13:06:51.2433678-06:00","updated_at":"2025-12-27T13:06:51.2433678-06:00","labels":["database","reliability"]}
{"id":"PRISM-hrq","title":"SEC-LOW: SSRF protection missing DNS rebinding prevention","description":"In server/utils/security.ts, isUrlSafeToFetch validates IP addresses at parse time but doesn't prevent DNS rebinding attacks where a domain resolves to private IP after validation. Consider IP validation at fetch time or use DNS pinning.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-27T13:03:47.7421669-06:00","updated_at":"2025-12-27T13:03:47.7421669-06:00","labels":["security","ssrf"]}
{"id":"PRISM-jj3","title":"SEC-MED: Rate limiting can be completely disabled in production","description":"Rate limiting can be disabled via RATE_LIMIT_ENABLED=false. This is intentional for AppViews operating like the first-party Bluesky AppView, where clients connect through their PDS (which handles rate limiting).\n\nThe only concern is that disabling also removes protection on:\n- authLimiter: Admin panel login (5 per 15 min)\n- oauthLimiter: OAuth callbacks (10 per 15 min)\n\nIf the admin panel is exposed publicly, these should remain enabled. Consider splitting into RATE_LIMIT_XRPC_ENABLED and RATE_LIMIT_AUTH_ENABLED for finer control.","status":"open","priority":3,"issue_type":"bug","created_at":"2025-12-27T13:03:31.1512339-06:00","updated_at":"2025-12-27T13:33:46.05442-06:00","labels":["rate-limiting","security"]}
{"id":"PRISM-jk1","title":"FEAT: Missing health check for external dependencies","description":"The /health and /ready endpoints don't check external dependency health (Redis, external APIs). Add comprehensive health checks that verify Redis connection, PDS reachability, and relay connectivity before reporting healthy.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-27T13:05:27.5960274-06:00","updated_at":"2025-12-27T13:05:27.5960274-06:00","labels":["health","observability"]}
{"id":"PRISM-nf2","title":"FEAT: Missing graceful shutdown handling","description":"No graceful shutdown handling in server/index.ts. When the process receives SIGTERM/SIGINT, it should finish processing current requests, flush Redis metrics buffer, close database connections, and unsubscribe from firehose before exiting.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-27T13:05:47.3164709-06:00","updated_at":"2025-12-27T13:05:47.3164709-06:00","labels":["feature","reliability"]}
{"id":"PRISM-p6t","title":"SEC-MED: CSRF logs potentially sensitive token information","description":"In server/middleware/csrf.ts:173-174, the CSRF validation logs partial signature data (first 8 chars of expected and actual). While truncated, this could aid timing attacks or provide information for token prediction. Remove sensitive data from logs.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T13:03:22.1575802-06:00","updated_at":"2025-12-27T13:35:08.9190386-06:00","closed_at":"2025-12-27T13:35:08.9190386-06:00","labels":["logging","security"]}
{"id":"PRISM-rud","title":"CODE: Lexicon validation commented out in event processor","description":"In server/services/event-processor.ts:1042-1046, lexicon validation is commented out with 'temporarily disabled for debugging'. This means invalid records could be persisted to the database. Re-enable validation or add a flag for development mode only.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-27T13:05:01.2085976-06:00","updated_at":"2025-12-27T13:05:01.2085976-06:00","labels":["bug","validation"]}
{"id":"PRISM-uho","title":"PERF: Data collection cache not bounded","description":"In server/services/event-processor.ts:268, dataCollectionCache is an unbounded Map that only clears every 5 minutes. Under high load with many unique DIDs, this could cause memory growth. Consider using LRU cache or BoundedMap.","status":"open","priority":3,"issue_type":"bug","created_at":"2025-12-27T13:06:32.9896672-06:00","updated_at":"2025-12-27T13:06:32.9896672-06:00","labels":["memory","performance"]}
{"id":"PRISM-x3y","title":"SEC-HIGH: PDS tokens skip cryptographic signature verification","description":"After deeper analysis, this is likely a non-issue or edge case:\n\n**Two auth systems exist (both working correctly):**\n1. OAuth for admin panel - uses @atproto/oauth-client-node with DPoP, PKCE, encrypted DB sessions\n2. Local session tokens - HS256 JWTs signed with SESSION_SECRET after OAuth login\n\n**The flagged code path:**\nverifyAtProtoToken() handles tokens from third-party Bluesky clients. It skips signature verification for tokens with scope 'com.atproto.access'.\n\n**Why this is likely fine:**\nIn standard AT Protocol flow, clients don't send PDS access tokens directly to AppViews. The flow is:\n- Client → PDS (with access token)\n- PDS → AppView (with SERVICE auth token signed by user's DID)\n- AppView verifies service auth token signature\n\nPDS access tokens (com.atproto.access) shouldn't reach the AppView directly. This code path may exist for:\n1. Legacy/compatibility reasons\n2. Direct-to-AppView clients (non-standard)\n3. Internal testing\n\n**Recommendation:**\nConsider logging when this code path is hit to understand if it's actually used. If never hit, consider removing or adding signature verification for defense in depth.","status":"open","priority":3,"issue_type":"bug","created_at":"2025-12-27T13:03:02.946497-06:00","updated_at":"2025-12-27T13:24:51.2704949-06:00","labels":["authentication","security"]}
{"id":"PRISM-y9m","title":"PERF: BoundedArrayMap type inconsistency in event processor","description":"In server/services/event-processor.ts:235-239, pendingOpIndex and pendingUserOpIndex are declared as Map\u003cstring,string\u003e but initialized with BoundedArrayMap\u003cstring,PendingUserCreationOp\u003e. This type mismatch could cause runtime issues.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-27T13:04:25.2836773-06:00","updated_at":"2025-12-27T13:04:25.2836773-06:00","labels":["bug","types"]}
